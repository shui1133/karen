<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºæ…§æŠ•è³‡ç†è²¡è¦åŠƒå·¥å…· - å°ˆå®¶ç´šå»ºè­°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f8fafc;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
        }
        .card {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
        }
        input[type="range"] {
            accent-color: #3b82f6;
        }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-6xl mx-auto">
        <!-- Header -->
        <header class="mb-8 text-center">
            <h1 class="text-3xl font-bold text-slate-800 mb-2">å°ˆæ¥­æŠ•è³‡ç†è²¡è¦åŠƒç³»çµ±</h1>
            <p class="text-slate-600">è¼¸å…¥æ‚¨çš„ç†è²¡ç›®æ¨™ï¼Œç²å¾—é‡èº«æ‰“é€ çš„è³‡ç”¢é…ç½®å»ºè­°</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Left: Inputs -->
            <div class="lg:col-span-1 space-y-6">
                <div class="card p-6">
                    <h2 class="text-xl font-semibold mb-4 flex items-center">
                        <span class="mr-2">ğŸ“‹</span> æŠ•è³‡éœ€æ±‚è¨­å®š
                    </h2>
                    
                    <!-- æŠ•è³‡æœŸé–“ -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-slate-700 mb-2">æŠ•è³‡æœŸé–“ (å¹´)</label>
                        <input type="number" id="years" value="10" min="1" max="50" 
                            class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                        <p class="text-xs text-slate-400 mt-1">å»ºè­°é•·æœŸæŠ•è³‡ä»¥ç™¼æ®è¤‡åˆ©æ•ˆæ‡‰</p>
                    </div>

                    <!-- æ¯æœˆæŠ•å…¥é‡‘é¡ -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-slate-700 mb-2">ç¬¬ä¸€å¹´æ¯æœˆæŠ•å…¥é‡‘é¡ (TWD)</label>
                        <div class="flex items-center space-x-4">
                            <input type="range" id="monthlyAmountRange" min="3000" max="100000" step="1000" value="10000" class="flex-1">
                            <span id="monthlyAmountText" class="text-blue-600 font-bold w-20 text-right">10,000</span>
                        </div>
                        <input type="number" id="monthlyAmountInput" value="10000" class="hidden">
                    </div>

                    <!-- é¢¨éšªæ‰¿å—åº¦ -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-slate-700 mb-2">é¢¨éšªæ‰¿å—åº¦</label>
                        <select id="riskLevel" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                            <option value="conservative">ä¿å®ˆå‹ (è¿½æ±‚ç©©å¥ã€ä½æ³¢å‹•)</option>
                            <option value="moderate" selected>ç©©å¥å‹ (å¹³è¡¡æˆé•·èˆ‡é¢¨éšª)</option>
                            <option value="aggressive">ç©æ¥µå‹ (è¿½æ±‚é«˜å ±é…¬ã€å¿å—é«˜æ³¢å‹•)</option>
                        </select>
                    </div>

                    <button id="calculateBtn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg transition duration-200">
                        ç”¢ç”ŸæŠ•è³‡è¦åŠƒå ±å‘Š
                    </button>
                </div>
            </div>

            <!-- Right: Results -->
            <div id="resultsArea" class="lg:col-span-2 space-y-6 hidden">
                <!-- Summary Tiles -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div class="card p-4 text-center border-t-4 border-blue-500">
                        <p class="text-xs text-slate-500">é æœŸç¸½è³‡ç”¢</p>
                        <p id="resTotalWealth" class="text-lg font-bold text-slate-800">-</p>
                    </div>
                    <div class="card p-4 text-center border-t-4 border-green-500">
                        <p class="text-xs text-slate-500">ç´¯è¨ˆæŠ•å…¥æœ¬é‡‘</p>
                        <p id="resTotalPrincipal" class="text-lg font-bold text-slate-800">-</p>
                    </div>
                    <div class="card p-4 text-center border-t-4 border-orange-500">
                        <p class="text-xs text-slate-500">ç¸½ç²åˆ©é‡‘é¡</p>
                        <p id="resTotalProfit" class="text-lg font-bold text-green-600">-</p>
                    </div>
                    <div class="card p-4 text-center border-t-4 border-purple-500">
                        <p class="text-xs text-slate-500">æ¯æœˆé è¨ˆé ˜æ¯</p>
                        <p id="resMonthlyIncome" class="text-lg font-bold text-blue-600">-</p>
                    </div>
                </div>

                <!-- Portfolio Breakdown -->
                <div class="card p-6">
                    <h3 class="text-xl font-bold mb-4 text-slate-800">è³‡ç”¢é…ç½®å»ºè­°å–®</h3>
                    <div class="flex flex-col md:flex-row gap-8 items-center">
                        <div class="w-full md:w-1/2">
                            <canvas id="portfolioChart"></canvas>
                        </div>
                        <div class="w-full md:w-1/2 space-y-4">
                            <div id="allocationList" class="space-y-2">
                                <!-- Dynamic List -->
                            </div>
                            <div class="bg-slate-50 p-4 rounded-lg">
                                <h4 class="font-bold text-sm text-slate-700 mb-1">é…ç½®ç†ç”±ï¼š</h4>
                                <p id="reasoningText" class="text-sm text-slate-600 leading-relaxed"></p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Growth Table -->
                <div class="card p-6 overflow-hidden">
                    <h3 class="text-xl font-bold mb-4 text-slate-800">å¹´åº¦è³‡ç”¢æˆé•·æ˜ç´° (æ¯å¹´æŠ•å…¥é‡‘é¡æˆé•· 5%)</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left text-sm">
                            <thead class="bg-slate-50 text-slate-600">
                                <tr>
                                    <th class="px-4 py-3 font-semibold">å¹´åº¦</th>
                                    <th class="px-4 py-3 font-semibold">æ¯æœˆæŠ•å…¥</th>
                                    <th class="px-4 py-3 font-semibold">ç´¯ç©æœ¬é‡‘</th>
                                    <th class="px-4 py-3 font-semibold">é ä¼°è³‡ç”¢</th>
                                    <th class="px-4 py-3 font-semibold">ROI (%)</th>
                                </tr>
                            </thead>
                            <tbody id="growthTableBody" class="divide-y divide-slate-100">
                                <!-- Dynamic Rows -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <footer class="mt-12 text-center text-slate-400 text-xs">
            *è¨»ï¼šæœ¬è©¦ç®—çµæœåƒ…ä¾›åƒè€ƒï¼Œä¸ä»£è¡¨æœªä¾†å¯¦éš›æ”¶ç›Šä¿è­‰ã€‚æŠ•è³‡å¿…æœ‰é¢¨éšªï¼Œè«‹è¬¹æ…è©•ä¼°ã€‚
        </footer>
    </div>

    <script>
        // é…ç½®æ¨¡å‹æ•¸æ“š
        const models = {
            conservative: {
                name: "ç©©å¥é˜²ç¦¦å‹",
                expectedRoi: 0.045,
                reason: "å°ˆæ³¨æ–¼é«˜è‚¡æ¯èˆ‡å‚µåˆ¸ï¼Œä»¥ä½æ³¢å‹•è³‡ç”¢é™ä½å¸‚å ´ä¸‹è¡Œè¡æ“Šï¼Œé©åˆè¿½æ±‚è³‡ç”¢ä¿å€¼èˆ‡é ˜æ¯çš„æŠ•è³‡è€…ã€‚",
                allocation: [
                    { label: "å…¨çƒå‚µåˆ¸å‹ ETF (å¦‚ BND/BNDX)", value: 50, color: "#64748b" },
                    { label: "å°è‚¡é«˜è‚¡æ¯ ETF (å¦‚ 00878/00713)", value: 30, color: "#10b981" },
                    { label: "å¸‚å ´åƒ¹å€¼å‹æ¨™çš„ (å¦‚ 0056)", value: 20, color: "#3b82f6" }
                ]
            },
            moderate: {
                name: "å¹³è¡¡æˆé•·å‹",
                expectedRoi: 0.075,
                reason: "è‚¡å‚µå¹³è¡¡é…ç½®ã€‚é€éå¸‚å€¼å‹ ETF åƒèˆ‡å¸‚å ´æˆé•·ï¼Œæ­é…å‚µåˆ¸ç·©è¡æ³¢å‹•ã€‚é©åˆå¤§å¤šæ•¸é•·æœŸè¦åŠƒè€…ã€‚",
                allocation: [
                    { label: "å°è‚¡å¸‚å ´å‹ ETF (å¦‚ 0050/006208)", value: 40, color: "#3b82f6" },
                    { label: "é«˜è‚¡æ¯/ä½æ³¢å‹•æ¨™çš„", value: 30, color: "#10b981" },
                    { label: "ç¾åœ‹é•·æœŸå…¬å‚µ (å¦‚ 00679B)", value: 30, color: "#64748b" }
                ]
            },
            aggressive: {
                name: "ç©æ¥µæˆé•·å‹",
                expectedRoi: 0.11,
                reason: "æœ€å¤§åŒ–è‚¡æ¬Šæ¯”ä¾‹ã€‚èšç„¦æˆé•·å‹ç§‘æŠ€è‚¡èˆ‡å¤§ç›¤ï¼Œé›–çŸ­æœŸæ³¢å‹•å¤§ï¼Œä½†é•·æœŸèƒ½äº«å—è³‡æœ¬åˆ©å¾—çš„æœ€å¤§åŒ–ã€‚",
                allocation: [
                    { label: "å°è‚¡å¤§ç›¤æ¬Šå€¼å‹ (0050)", value: 50, color: "#3b82f6" },
                    { label: "åŠå°é«”/ç§‘æŠ€ç”¢æ¥­ ETF (å¦‚ 00830)", value: 30, color: "#f59e0b" },
                    { label: "å…¨çƒè‚¡ç¥¨å‹ ETF (å¦‚ VT)", value: 20, color: "#8b5cf6" }
                ]
            }
        };

        let myChart = null;

        // é€£å‹• UI
        const range = document.getElementById('monthlyAmountRange');
        const text = document.getElementById('monthlyAmountText');
        range.addEventListener('input', (e) => {
            text.innerText = Number(e.target.value).toLocaleString();
        });

        // æ ¸å¿ƒè¨ˆç®—é‚è¼¯
        function calculate() {
            const years = parseInt(document.getElementById('years').value) || 10;
            const startMonthly = parseInt(range.value);
            const risk = document.getElementById('riskLevel').value;
            const model = models[risk];

            const annualIncreaseRate = 0.05; // æ¯å¹´å¢é¡ 5%
            const expectedRoi = model.expectedRoi;

            let currentMonthly = startMonthly;
            let cumulativePrincipal = 0;
            let currentWealth = 0;
            let history = [];

            for (let y = 1; y <= years; y++) {
                let yearlyInvestment = 0;
                
                // æ¯å€‹æœˆæŠ•å…¥
                for (let m = 1; m <= 12; m++) {
                    yearlyInvestment += currentMonthly;
                    // è¨ˆç®—æœˆè¤‡åˆ©
                    currentWealth = (currentWealth + currentMonthly) * (1 + (expectedRoi / 12));
                }

                cumulativePrincipal += yearlyInvestment;
                
                let roi = ((currentWealth - cumulativePrincipal) / cumulativePrincipal * 100).toFixed(1);

                history.push({
                    year: y,
                    monthly: currentMonthly,
                    principal: cumulativePrincipal,
                    wealth: currentWealth,
                    roi: roi
                });

                // ä¸‹ä¸€å¹´å¢åŠ  5% æŠ•å…¥
                currentMonthly = currentMonthly * (1 + annualIncreaseRate);
            }

            displayResults(model, history);
        }

        function displayResults(model, history) {
            const lastYear = history[history.length - 1];
            
            document.getElementById('resultsArea').classList.remove('hidden');
            document.getElementById('resTotalWealth').innerText = `NT$ ${Math.round(lastYear.wealth).toLocaleString()}`;
            document.getElementById('resTotalPrincipal').innerText = `NT$ ${Math.round(lastYear.principal).toLocaleString()}`;
            document.getElementById('resTotalProfit').innerText = `NT$ ${Math.round(lastYear.wealth - lastYear.principal).toLocaleString()}`;
            
            // é è¨ˆæœˆé ˜æ¯ (ä»¥æœ€å¾Œè³‡ç”¢çš„ 4% æ®–åˆ©ç‡ç²—ä¼°)
            const monthlyYield = (lastYear.wealth * 0.04) / 12;
            document.getElementById('resMonthlyIncome').innerText = `NT$ ${Math.round(monthlyYield).toLocaleString()}`;

            document.getElementById('reasoningText').innerText = model.reason;

            // æ›´æ–°åˆ—è¡¨
            const listContainer = document.getElementById('allocationList');
            listContainer.innerHTML = '';
            model.allocation.forEach(item => {
                const div = document.createElement('div');
                div.className = "flex justify-between items-center text-sm";
                div.innerHTML = `
                    <span class="flex items-center"><span class="w-3 h-3 rounded-full mr-2" style="background:${item.color}"></span> ${item.label}</span>
                    <span class="font-bold text-slate-700">${item.value}%</span>
                `;
                listContainer.appendChild(div);
            });

            // æ›´æ–°è¡¨æ ¼
            const tableBody = document.getElementById('growthTableBody');
            tableBody.innerHTML = '';
            history.forEach(row => {
                const tr = document.createElement('tr');
                tr.className = "hover:bg-slate-50 transition";
                tr.innerHTML = `
                    <td class="px-4 py-3 text-slate-600 font-medium">${row.year}å¹´</td>
                    <td class="px-4 py-3">${Math.round(row.monthly).toLocaleString()}</td>
                    <td class="px-4 py-3">${Math.round(row.principal).toLocaleString()}</td>
                    <td class="px-4 py-3 text-blue-600 font-bold">${Math.round(row.wealth).toLocaleString()}</td>
                    <td class="px-4 py-3 text-green-600">${row.roi}%</td>
                `;
                tableBody.appendChild(tr);
            });

            // æ›´æ–°åœ–è¡¨
            updateChart(model);
            
            // æ²å‹•åˆ°çµæœå€
            document.getElementById('resultsArea').scrollIntoView({ behavior: 'smooth' });
        }

        function updateChart(model) {
            const ctx = document.getElementById('portfolioChart').getContext('2d');
            
            if (myChart) {
                myChart.destroy();
            }

            myChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: model.allocation.map(a => a.label),
                    datasets: [{
                        data: model.allocation.map(a => a.value),
                        backgroundColor: model.allocation.map(a => a.color),
                        borderWidth: 0,
                        hoverOffset: 10
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    cutout: '70%'
                }
            });
        }

        document.getElementById('calculateBtn').addEventListener('click', calculate);

        // åˆå§‹åŒ–
        window.onload = () => {
            console.log("ç†è²¡è¦åŠƒç³»çµ±å·²å°±ç·’");
        };
    </script>
</body>
</html>